# MacWallpaper

一个简洁高效的 macOS 动态视频壁纸应用。

## 功能特性

### 核心功能
- ✅ **视频壁纸播放** - 支持 MP4/MOV 等主流视频格式
- ✅ **多屏幕支持** - 自动适配多显示器配置
- ✅ **循环播放** - 自动无缝循环视频
- ✅ **启用/禁用** - 一键开关，禁用后无黑屏
- ✅ **音量控制** - 支持静音/取消静音
- ✅ **质量设置** - 低/中/高/原始四档质量选择
- ✅ **智能启动** - 自动恢复上次播放的壁纸

### 界面交互
- ✅ **单击选择** - 单击壁纸查看详细信息
- ✅ **双击应用** - 双击壁纸直接应用
- ✅ **右键菜单** - 应用壁纸、删除壁纸
- ✅ **智能检查器** - 点击显示，点击空白区域隐藏
- ✅ **当前壁纸指示** - 绿色圆点标记正在使用的壁纸
- ✅ **收藏功能** - 右键添加喜欢，黄色星星标记
- ✅ **智能排序** - 喜欢的 > 最近播放 > 其他
- ✅ **状态栏控制** - 快速访问常用功能

### 管理功能
- ✅ **批量导入** - 从文件夹递归导入所有视频
- ✅ **手动添加** - 选择单个或多个视频文件
- ✅ **删除管理** - 带确认的安全删除
- ✅ **收藏管理** - 右键添加/取消喜欢
- ✅ **智能记忆** - 记住上次播放和收藏状态
- ✅ **持久化存储** - 自动保存所有数据

## 使用说明

### 添加壁纸
1. **单个添加**: 点击工具栏 "+" 按钮，选择视频文件
2. **批量导入**: 点击工具栏 "文件夹+" 按钮，选择包含视频的文件夹
3. **全局设置**: 点击工具栏 "⚙️" 按钮，配置壁纸搜索路径

### 应用壁纸
- **方式一**: 双击壁纸缩略图
- **方式二**: 单击选中 → 检查器中点击"应用壁纸"
- **方式三**: 右键壁纸 → 选择"应用壁纸"

### 管理壁纸
- **查看详情**: 单击壁纸，右侧检查器显示详细信息
- **调整设置**: 在检查器中调整启用/禁用、静音、播放质量
- **添加收藏**: 右键壁纸 → 选择"添加到喜欢"（黄色星星标记）
- **取消收藏**: 右键已收藏壁纸 → 选择"取消喜欢"
- **删除壁纸**: 右键壁纸 → 选择"删除壁纸"
- **识别当前**: 绿色圆点标记正在应用的壁纸
- **智能排序**: 收藏的壁纸和最近播放的壁纸自动排在前面

### 状态栏
- **打开主窗口**: 管理壁纸库
- **启用/停用壁纸**: 总开关，文字动态变化
- **静音控制**: 一键静音/取消静音
- **Dock 图标**: 显示/隐藏 Dock 图标
- **关于/退出**: 应用信息和退出

## 技术特性

### 架构设计
- **Linus 式简洁**: 数据结构优先，消除特殊情况
- **Swift 6 兼容**: 严格并发检查，线程安全
- **主线程隔离**: 所有 UI 操作使用 @MainActor
- **委托模式**: 清晰的事件流和责任分离

### 性能优化
- **按需加载**: 缩略图异步生成
- **智能刷新**: 避免不必要的 CollectionView 重绘
- **内存管理**: 合理的播放器生命周期
- **窗口层级**: 正确的桌面级别显示

### 用户体验
- **流畅动画**: 0.25s 过渡动画
- **视觉反馈**: 绿色圆点（当前）+ 黄色星星（收藏）
- **智能隐藏**: 检查器自动显示/隐藏
- **智能启动**: 
  - 自动恢复上次壁纸
  - 优先级：上次播放 > 收藏 > 最近播放 > 首个
- **响应式布局**: 适配不同窗口尺寸

## 系统要求

- macOS 12.0 或更高版本
- Swift 6.2 工具链
- 支持 MP4、MOV、M4V 等视频格式

## 构建

```bash
cd MacWallpaper
swift build
swift run
```

## 项目结构

```
MacWallpaper/
├── Sources/MacWallpaper/
│   ├── MacWallpaper.swift          # 应用入口
│   ├── AppDelegate.swift           # 应用委托
│   ├── MainWindowController.swift # 主窗口控制器
│   ├── MainViewController.swift   # 主视图控制器
│   ├── StatusBarController.swift  # 状态栏控制器
│   ├── WallpaperEngine.swift      # 壁纸引擎（启用/禁用、记忆）
│   ├── WallpaperWindow.swift      # 壁纸窗口
│   ├── WallpaperManager.swift     # 壁纸管理器（收藏、排序）
│   ├── InspectorView.swift        # 检查器视图
│   └── WallpaperCollectionViewItem.swift # 集合视图项
├── Resources/                      # 资源文件
└── Package.swift                   # Swift Package 配置
```

## 设计哲学

### "Good Taste" - 好的设计
- **消除边界情况**: 单击=选中，双击=应用，右键=菜单
- **数据驱动 UI**: 状态改变驱动界面更新
- **简洁胜于复杂**: 没有多余的抽象层
- **智能排序**: 收藏 > 最近播放 > 添加时间，零配置

### "Never Break Userspace"
- **向后兼容**: 壁纸库数据持久化
- **平滑升级**: 不破坏现有配置

### 实用主义
- **解决真问题**: 
  - 黑屏问题 → 启用/禁用功能
  - 有声无画面 → 修复窗口层级
  - 崩溃问题 → 延迟窗口创建
- **性能优先**: 避免卡顿 → 优化刷新逻辑
- **用户友好**: 
  - 直观的交互 → 双击应用，右键菜单
  - 智能记忆 → 自动恢复上次壁纸

## 更新日志

### v0.2.0 (最新)
- ✅ 新增启用/禁用壁纸功能（解决黑屏问题）
- ✅ 新增收藏功能（黄色星星标记）
- ✅ 智能排序：收藏 > 最近播放 > 其他
- ✅ 自动记忆上次播放的壁纸
- ✅ 状态栏菜单文字动态更新
- ✅ 修复窗口创建时机导致的崩溃
- ✅ 优化首次启动体验

### v0.1.0
- ✅ 基础视频壁纸播放
- ✅ 多屏幕支持
- ✅ 静音和质量控制
- ✅ 壁纸库管理

## 已知问题

- [ ] 使用 deprecated NSUserNotification (计划迁移到 UserNotifications)
- [ ] 需要支持更多视频格式
- [ ] 缺少视频预览功能
- [ ] 收藏列表暂无独立展示界面

## 许可证

查看 LICENSE 文件了解详情。

## 贡献

欢迎提交 Issue 和 Pull Request！

---

**Built with Good Taste™** 🎨